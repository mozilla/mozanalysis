<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mozanalysis.experiment &mdash; mozanalysis  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mozanalysis.exposure" href="exposure.html" />
    <link rel="prev" title="mozanalysis.config" href="config.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            mozanalysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Mozanalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide.html">Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">API Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bayesian_stats.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bayesian_stats</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="bayesian_stats/bayesian_bootstrap.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bayesian_stats.bayesian_bootstrap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="bayesian_stats/binary.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bayesian_stats.binary</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="bayesian_stats/survival_func.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bayesian_stats.survival_func</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="bq.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bq</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.config</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.experiment</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mozanalysis.experiment.EnrollmentsQueryType"><code class="docutils literal notranslate"><span class="pre">EnrollmentsQueryType</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#mozanalysis.experiment.Experiment"><code class="docutils literal notranslate"><span class="pre">Experiment</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.Experiment.experiment_slug"><code class="docutils literal notranslate"><span class="pre">Experiment.experiment_slug</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.Experiment.start_date"><code class="docutils literal notranslate"><span class="pre">Experiment.start_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.Experiment.num_dates_enrollment"><code class="docutils literal notranslate"><span class="pre">Experiment.num_dates_enrollment</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.Experiment.get_app_name"><code class="docutils literal notranslate"><span class="pre">Experiment.get_app_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.Experiment.get_single_window_data"><code class="docutils literal notranslate"><span class="pre">Experiment.get_single_window_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.Experiment.get_time_series_data"><code class="docutils literal notranslate"><span class="pre">Experiment.get_time_series_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.Experiment.build_enrollments_query"><code class="docutils literal notranslate"><span class="pre">Experiment.build_enrollments_query()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.Experiment.build_metrics_query"><code class="docutils literal notranslate"><span class="pre">Experiment.build_metrics_query()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mozanalysis.experiment.TimeLimits"><code class="docutils literal notranslate"><span class="pre">TimeLimits</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.TimeLimits.for_single_analysis_window"><code class="docutils literal notranslate"><span class="pre">TimeLimits.for_single_analysis_window()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.TimeLimits.for_ts"><code class="docutils literal notranslate"><span class="pre">TimeLimits.for_ts()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mozanalysis.experiment.AnalysisWindow"><code class="docutils literal notranslate"><span class="pre">AnalysisWindow</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#mozanalysis.experiment.TimeSeriesResult"><code class="docutils literal notranslate"><span class="pre">TimeSeriesResult</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.TimeSeriesResult.get"><code class="docutils literal notranslate"><span class="pre">TimeSeriesResult.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.TimeSeriesResult.get_full_data"><code class="docutils literal notranslate"><span class="pre">TimeSeriesResult.get_full_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.experiment.TimeSeriesResult.get_aggregated_data"><code class="docutils literal notranslate"><span class="pre">TimeSeriesResult.get_aggregated_data()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="exposure.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.exposure</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="frequentist_stats/bootstrap.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.frequentist_stats.bootstrap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="frequentist_stats/sample_size.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.frequentist_stats.sample_size</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.metrics</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics/desktop.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.metrics.desktop</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics/fenix.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.metrics.fenix</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics/firefox_ios.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.metrics.firefox_ios</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="segments.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.segments</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="segments/desktop.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.segments.desktop</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="sizing.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.sizing</span></code></a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">mozanalysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api.html">API Documentation</a></li>
      <li class="breadcrumb-item active"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.experiment</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/experiment.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-mozanalysis.experiment">
<span id="mozanalysis-experiment"></span><h1><a class="reference internal" href="#module-mozanalysis.experiment" title="mozanalysis.experiment"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.experiment</span></code></a><a class="headerlink" href="#module-mozanalysis.experiment" title="Link to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mozanalysis.experiment.EnrollmentsQueryType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mozanalysis.experiment.</span></span><span class="sig-name descname"><span class="pre">EnrollmentsQueryType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#EnrollmentsQueryType"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.EnrollmentsQueryType" title="Link to this definition"></a></dt>
<dd><p>An enumeration.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mozanalysis.experiment.</span></span><span class="sig-name descname"><span class="pre">Experiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_slug</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_dates_enrollment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">app_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">app_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#Experiment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.Experiment" title="Link to this definition"></a></dt>
<dd><p>Query experiment data; store experiment metadata.</p>
<p>The methods here query data in a way compatible with the following
principles, which are important for experiment analysis:</p>
<ul class="simple">
<li><p>The population of clients in each branch must have the same
properties, aside from the intervention itself and its
consequences; i.e. there must be no underlying bias in the
branch populations.</p></li>
<li><p>We must measure the same thing for each client, to minimize the
variance associated with our measurement.</p></li>
</ul>
<p>So that our analyses follow these abstract principles, we follow
these rules:</p>
<ul class="simple">
<li><p>Start with a list of all clients who enrolled.</p></li>
<li><p>We can filter this list of clients only based on information known
to us at or before the time that they enrolled, because later
information might be causally connected to the intervention.</p></li>
<li><p>For any given metric, every client gets a non-null value; we don’t
implicitly ignore anyone, even if they churned and stopped
sending data.</p></li>
<li><p>Typically if an enrolled client no longer qualifies for enrollment,
we’ll still want to include their data in the analysis, unless
we’re explicitly using stats methods that handle censored data.</p></li>
<li><p>We define a “analysis window” with respect to clients’
enrollment dates. Each metric only uses data collected inside
this analysis window. We can only analyze data for a client
if we have data covering their entire analysis window.</p></li>
</ul>
<p>Example usage (in a colab notebook):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="n">auth</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Authenticated&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">mozanalysis.experiment</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="kn">from</span> <span class="nn">mozanalysis.bq</span> <span class="kn">import</span> <span class="n">BigQueryContext</span>
<span class="kn">from</span> <span class="nn">mozanalysis.metrics.desktop</span> <span class="kn">import</span> <span class="n">active_hours</span><span class="p">,</span> <span class="n">uri_count</span>

<span class="n">bq_context</span> <span class="o">=</span> <span class="n">BigQueryContext</span><span class="p">(</span>
    <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;your-dataset-id&#39;</span><span class="p">,</span>  <span class="c1"># e.g. mine&#39;s flawrence</span>
    <span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;moz-fx-data-bq-data-science&#39;</span>  <span class="c1"># this is the default anyway</span>
<span class="p">)</span>

<span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
    <span class="n">experiment_slug</span><span class="o">=</span><span class="s1">&#39;pref-fingerprinting-protections-retention-study-release-70&#39;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="s1">&#39;2019-10-29&#39;</span><span class="p">,</span>
    <span class="n">num_dates_enrollment</span><span class="o">=</span><span class="mi">8</span>
<span class="p">)</span>

<span class="c1"># Run the query and get the results as a DataFrame</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">get_single_window_data</span><span class="p">(</span>
    <span class="n">bq_context</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="n">active_hours</span><span class="p">,</span>
        <span class="n">uri_count</span>
    <span class="p">],</span>
    <span class="n">last_date_full_data</span><span class="o">=</span><span class="s1">&#39;2019-12-01&#39;</span><span class="p">,</span>
    <span class="n">analysis_start_days</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">analysis_length_days</span><span class="o">=</span><span class="mi">7</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_slug</strong> (<em>str</em>) – Name of the study, used to identify
the enrollment events specific to this study.</p></li>
<li><p><strong>start_date</strong> (<em>str</em>) – e.g. ‘2019-01-01’. First date on which enrollment
events were received.</p></li>
<li><p><strong>num_dates_enrollment</strong> (<em>int</em><em>, </em><em>optional</em>) – Only include this many dates
of enrollments. If <code class="docutils literal notranslate"><span class="pre">None</span></code> then use the maximum number of dates
as determined by the metric’s analysis window and
<code class="docutils literal notranslate"><span class="pre">last_date_full_data</span></code>. Typically <code class="docutils literal notranslate"><span class="pre">7n+1</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">8</span></code>. The
factor ‘7’ removes weekly seasonality, and the <code class="docutils literal notranslate"><span class="pre">+1</span></code> accounts
for the fact that enrollment typically starts a few hours
before UTC midnight.</p></li>
<li><p><strong>app_id</strong> (<em>str</em><em>, </em><em>optional</em>) – For a Glean app, the name of the BigQuery
dataset derived from its app ID, like <cite>org_mozilla_firefox</cite>.</p></li>
<li><p><strong>app_name</strong> (<em>str</em><em>, </em><em>optional</em>) – The Glean app name, like <cite>fenix</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment.experiment_slug">
<span class="sig-name descname"><span class="pre">experiment_slug</span></span><a class="headerlink" href="#mozanalysis.experiment.Experiment.experiment_slug" title="Link to this definition"></a></dt>
<dd><p>Name of the study, used to identify
the enrollment events specific to this study.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment.start_date">
<span class="sig-name descname"><span class="pre">start_date</span></span><a class="headerlink" href="#mozanalysis.experiment.Experiment.start_date" title="Link to this definition"></a></dt>
<dd><p>e.g. ‘2019-01-01’. First date on which enrollment
events were received.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment.num_dates_enrollment">
<span class="sig-name descname"><span class="pre">num_dates_enrollment</span></span><a class="headerlink" href="#mozanalysis.experiment.Experiment.num_dates_enrollment" title="Link to this definition"></a></dt>
<dd><p>Only include this many days
of enrollments. If <code class="docutils literal notranslate"><span class="pre">None</span></code> then use the maximum number of days
as determined by the metric’s analysis window and
<code class="docutils literal notranslate"><span class="pre">last_date_full_data</span></code>. Typically <code class="docutils literal notranslate"><span class="pre">7n+1</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">8</span></code>. The
factor ‘7’ removes weekly seasonality, and the <code class="docutils literal notranslate"><span class="pre">+1</span></code> accounts
for the fact that enrollment typically starts a few hours
before UTC midnight.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment.get_app_name">
<span class="sig-name descname"><span class="pre">get_app_name</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#Experiment.get_app_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.Experiment.get_app_name" title="Link to this definition"></a></dt>
<dd><p>Determine the correct app name.</p>
<p>If no explicit app name has been passed into Experiment, lookup app name from
a pre-defined list. (this is deprecated)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment.get_single_window_data">
<span class="sig-name descname"><span class="pre">get_single_window_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bq_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><span class="pre">BigQueryContext</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_date_full_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_start_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_length_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enrollments_query_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mozanalysis.experiment.EnrollmentsQueryType" title="mozanalysis.experiment.EnrollmentsQueryType"><span class="pre">EnrollmentsQueryType</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">EnrollmentsQueryType.NORMANDY</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_enrollments_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_exposure_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exposure_signal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#Experiment.get_single_window_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.Experiment.get_single_window_data" title="Link to this definition"></a></dt>
<dd><p>Return a DataFrame containing per-client metric values.</p>
<p>Also store them in a permanent table in BigQuery. The name of
this table will be printed. Subsequent calls to this function
will simply read the results from this table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bq_context</strong> (<a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><em>BigQueryContext</em></a>) – BigQuery configuration and client.</p></li>
<li><p><strong>metric_list</strong> (<em>list</em><em> of </em><em>mozanalysis.metric.Metric</em><em> or </em><em>str</em>) – The metrics
to analyze.</p></li>
<li><p><strong>last_date_full_data</strong> (<em>str</em>) – The most recent date for which we
have complete data, e.g. ‘2019-03-22’. If you want to ignore
all data collected after a certain date (e.g. when the
experiment recipe was deactivated), then do that here.</p></li>
<li><p><strong>analysis_start_days</strong> (<em>int</em>) – the start of the analysis window,
measured in ‘days since the client enrolled’. We ignore data
collected outside this analysis window.</p></li>
<li><p><strong>analysis_length_days</strong> (<em>int</em>) – the length of the analysis window,
measured in days.</p></li>
<li><p><strong>enrollments_query_type</strong> (<a class="reference internal" href="#mozanalysis.experiment.EnrollmentsQueryType" title="mozanalysis.experiment.EnrollmentsQueryType"><em>EnrollmentsQueryType</em></a>) – (‘normandy’, ‘glean-event’, ‘cirrus’, or ‘fenix-fallback’)
Specifies the query type to use to get the experiment’s
enrollments, unless overridden by
<code class="docutils literal notranslate"><span class="pre">custom_enrollments_query</span></code>.</p></li>
<li><p><strong>custom_enrollments_query</strong> (<em>str</em>) – <p>A full SQL query that
will generate the <cite>enrollments</cite> common table expression
used in the main query. The query must produce the columns
<cite>client_id</cite>, <cite>branch</cite>, <cite>enrollment_date</cite>, and <cite>num_enrolled_events</cite>.</p>
<p>WARNING: this query’s results must be uniquely keyed by
(client_id, branch), or else your results will be subtly
wrong.</p>
</p></li>
<li><p><strong>custom_exposure_query</strong> (<em>str</em>) – <p>A full SQL query that
will generate the <cite>exposures</cite> common table expression
used in the main query. The query must produce the columns
<cite>client_id</cite>, <cite>branch</cite>, <cite>enrollment_date</cite>, and <cite>num_exposure_events</cite>.</p>
<p>If not provided, the exposure will be determined based on
<cite>exposure_signal</cite>, if provided, or Normandy and Nimbus exposure events.
<cite>custom_exposure_query</cite> takes precedence over <cite>exposure_signal</cite>.</p>
</p></li>
<li><p><strong>exposure_signal</strong> (<a class="reference internal" href="exposure.html#mozanalysis.exposure.ExposureSignal" title="mozanalysis.exposure.ExposureSignal"><em>ExposureSignal</em></a>) – Optional signal definition of when a
client has been exposed to the experiment. If not provided,
the exposure will be determined based on Normandy exposure events
for desktop and Nimbus exposure events for Fenix and iOS.</p></li>
<li><p><strong>segment_list</strong> (<em>list</em><em> of </em><em>mozanalysis.segment.Segment</em><em> or </em><em>str</em>) – The user
segments to study.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A pandas DataFrame of experiment data. One row per <code class="docutils literal notranslate"><span class="pre">client_id</span></code>.
Some metadata columns, then one column per metric in
<code class="docutils literal notranslate"><span class="pre">metric_list</span></code>, and one column per sanity-check metric.
Columns (not necessarily in order):</p>
<blockquote>
<div><ul class="simple">
<li><p>client_id (str): Not necessary for “happy path” analyses.</p></li>
<li><p>branch (str): The client’s branch</p></li>
<li><p>other columns of <code class="docutils literal notranslate"><span class="pre">enrollments</span></code>.</p></li>
<li><p>[metric 1]: The client’s value for the first metric in
<code class="docutils literal notranslate"><span class="pre">metric_list</span></code>.</p></li>
<li><p>…</p></li>
<li><p>[metric n]: The client’s value for the nth (final)
metric in <code class="docutils literal notranslate"><span class="pre">metric_list</span></code>.</p></li>
<li><p>[sanity check 1]: The client’s value for the first
sanity check metric for the first data source that
supports sanity checks.</p></li>
<li><p>…</p></li>
<li><p>[sanity check n]: The client’s value for the last
sanity check metric for the last data source that
supports sanity checks.</p></li>
</ul>
</div></blockquote>
<p>This format - the schema plus there being one row per
enrolled client, regardless of whether the client has data
in <code class="docutils literal notranslate"><span class="pre">data_source</span></code> - was agreed upon by the DS team, and is the
standard format for queried experimental data.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment.get_time_series_data">
<span class="sig-name descname"><span class="pre">get_time_series_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bq_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><span class="pre">BigQueryContext</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_date_full_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_series_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'weekly'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enrollments_query_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mozanalysis.experiment.EnrollmentsQueryType" title="mozanalysis.experiment.EnrollmentsQueryType"><span class="pre">EnrollmentsQueryType</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">EnrollmentsQueryType.NORMANDY</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_enrollments_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_exposure_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exposure_signal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#mozanalysis.experiment.TimeSeriesResult" title="mozanalysis.experiment.TimeSeriesResult"><span class="pre">TimeSeriesResult</span></a></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#Experiment.get_time_series_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.Experiment.get_time_series_data" title="Link to this definition"></a></dt>
<dd><p>Return a TimeSeriesResult with per-client metric values.</p>
<p>Roughly equivalent to looping over <a class="reference internal" href="#mozanalysis.experiment.Experiment.get_single_window_data" title="mozanalysis.experiment.Experiment.get_single_window_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_single_window_data()</span></code></a>
with different analysis windows, and reorganising the results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bq_context</strong> (<a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><em>BigQueryContext</em></a>) – BigQuery configuration and client.</p></li>
<li><p><strong>metric_list</strong> (<em>list</em><em> of </em><em>mozanalysis.metric.Metric</em>) – The metrics to analyze.</p></li>
<li><p><strong>last_date_full_data</strong> (<em>str</em>) – The most recent date for which we
have complete data, e.g. ‘2019-03-22’. If you want to ignore
all data collected after a certain date (e.g. when the
experiment recipe was deactivated), then do that here.</p></li>
<li><p><strong>time_series_period</strong> (<em>'daily'</em><em> or </em><em>'weekly'</em>) – How long each
analysis window should be.</p></li>
<li><p><strong>enrollments_query_type</strong> (<a class="reference internal" href="#mozanalysis.experiment.EnrollmentsQueryType" title="mozanalysis.experiment.EnrollmentsQueryType"><em>EnrollmentsQueryType</em></a>) – (‘normandy’, ‘glean-event’, ‘cirrus’, or ‘fenix-fallback’)
Specifies the query type to use to get the experiment’s
enrollments, unless overridden by
<code class="docutils literal notranslate"><span class="pre">custom_enrollments_query</span></code>.</p></li>
<li><p><strong>custom_enrollments_query</strong> (<em>str</em>) – <p>A full SQL query that
will generate the <cite>enrollments</cite> common table expression
used in the main query. The query must produce the columns
<cite>client_id</cite>, <cite>branch</cite>, <cite>enrollment_date</cite>, and <cite>num_enrolled_events</cite>.</p>
<p>WARNING: this query’s results must be uniquely keyed by
(client_id, branch), or else your results will be subtly
wrong.</p>
</p></li>
<li><p><strong>custom_exposure_query</strong> (<em>str</em>) – <p>A full SQL query that
will generate the <cite>exposures</cite> common table expression
used in the main query. The query must produce the columns
<cite>client_id</cite>, <cite>branch</cite>, <cite>enrollment_date</cite>, and <cite>num_exposure_events</cite>.</p>
<p>If not provided, the exposure will be determined based on
<cite>exposure_signal</cite>, if provided, or Normandy and Nimbus exposure events.
<cite>custom_exposure_query</cite> takes precedence over <cite>exposure_signal</cite>.</p>
</p></li>
<li><p><strong>exposure_signal</strong> (<a class="reference internal" href="exposure.html#mozanalysis.exposure.ExposureSignal" title="mozanalysis.exposure.ExposureSignal"><em>ExposureSignal</em></a>) – Optional signal definition of when a
client has been exposed to the experiment. If not provided,
the exposure will be determined based on Normandy exposure events
for desktop and Nimbus exposure events for Fenix and iOS.</p></li>
<li><p><strong>segment_list</strong> (<em>list</em><em> of </em><em>mozanalysis.segment.Segment</em>) – The user
segments to study.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A <a class="reference internal" href="#mozanalysis.experiment.TimeSeriesResult" title="mozanalysis.experiment.TimeSeriesResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">mozanalysis.experiment.TimeSeriesResult</span></code></a> object,
which may be used to obtain a
pandas DataFrame of per-client metric data, for each
analysis window. Each DataFrame is a pandas DataFrame in
“the standard format”: one row per client, some metadata
columns, plus one column per metric and sanity-check metric.
Its columns (not necessarily in order):</p>
<blockquote>
<div><ul class="simple">
<li><p>branch (str): The client’s branch</p></li>
<li><p>other columns of <code class="docutils literal notranslate"><span class="pre">enrollments</span></code>.</p></li>
<li><p>[metric 1]: The client’s value for the first metric in
<code class="docutils literal notranslate"><span class="pre">metric_list</span></code>.</p></li>
<li><p>…</p></li>
<li><p>[metric n]: The client’s value for the nth (final)
metric in <code class="docutils literal notranslate"><span class="pre">metric_list</span></code>.</p></li>
<li><p>[sanity check 1]: The client’s value for the first
sanity check metric for the first data source that
supports sanity checks.</p></li>
<li><p>…</p></li>
<li><p>[sanity check n]: The client’s value for the last
sanity check metric for the last data source that
supports sanity checks.</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment.build_enrollments_query">
<span class="sig-name descname"><span class="pre">build_enrollments_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time_limits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mozanalysis.experiment.TimeLimits" title="mozanalysis.experiment.TimeLimits"><span class="pre">TimeLimits</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">enrollments_query_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mozanalysis.experiment.EnrollmentsQueryType" title="mozanalysis.experiment.EnrollmentsQueryType"><span class="pre">EnrollmentsQueryType</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">EnrollmentsQueryType.NORMANDY</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_enrollments_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_exposure_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exposure_signal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#Experiment.build_enrollments_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.Experiment.build_enrollments_query" title="Link to this definition"></a></dt>
<dd><p>Return a SQL query for querying enrollment and exposure data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time_limits</strong> (<a class="reference internal" href="#mozanalysis.experiment.TimeLimits" title="mozanalysis.experiment.TimeLimits"><em>TimeLimits</em></a>) – An object describing the
interval(s) to query</p></li>
<li><p><strong>enrollments_query_type</strong> (<a class="reference internal" href="#mozanalysis.experiment.EnrollmentsQueryType" title="mozanalysis.experiment.EnrollmentsQueryType"><em>EnrollmentsQueryType</em></a>) – (‘normandy’, ‘glean-event’, ‘cirrus’, or ‘fenix-fallback’)
Specifies the query type to use to get the experiment’s
enrollments, unless overridden by
<code class="docutils literal notranslate"><span class="pre">custom_enrollments_query</span></code>.</p></li>
<li><p><strong>custom_enrollments_query</strong> (<em>str</em>) – <p>A full SQL query that
will generate the <cite>enrollments</cite> common table expression
used in the main query. The query must produce the columns
<cite>client_id</cite>, <cite>branch</cite>, <cite>enrollment_date</cite>, and <cite>num_enrolled_events</cite>.</p>
<p>WARNING: this query’s results must be uniquely keyed by
(client_id, branch), or else your results will be subtly
wrong.</p>
</p></li>
<li><p><strong>custom_exposure_query</strong> (<em>str</em>) – A full SQL query that
will generate the <cite>exposures</cite> common table expression
used in the main query. The query must produce the columns
<cite>client_id</cite>, <cite>branch</cite>, <cite>enrollment_date</cite>, and <cite>num_exposure_events</cite>.</p></li>
<li><p><strong>exposure_signal</strong> (<a class="reference internal" href="exposure.html#mozanalysis.exposure.ExposureSignal" title="mozanalysis.exposure.ExposureSignal"><em>ExposureSignal</em></a>) – Optional signal definition of when a
client has been exposed to the experiment</p></li>
<li><p><strong>segment_list</strong> (<em>list</em><em> of </em><em>mozanalysis.segment.Segment</em><em> or </em><em>str</em>) – The user
segments to study.</p></li>
<li><p><strong>sample_size</strong> (<em>int</em>) – Optional integer percentage of clients, used for
downsampling enrollments. Default 100.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A string containing a BigQuery SQL expression.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.Experiment.build_metrics_query">
<span class="sig-name descname"><span class="pre">build_metrics_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metric_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_limits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mozanalysis.experiment.TimeLimits" title="mozanalysis.experiment.TimeLimits"><span class="pre">TimeLimits</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">enrollments_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_basis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">AnalysisBasis.ENROLLMENTS</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exposure_signal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#Experiment.build_metrics_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.Experiment.build_metrics_query" title="Link to this definition"></a></dt>
<dd><p>Return a SQL query for querying metric data.</p>
<p>For interactive use, prefer <a class="reference internal" href="#mozanalysis.experiment.Experiment.get_time_series_data" title="mozanalysis.experiment.Experiment.get_time_series_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_time_series_data()</span></code></a> or
<a class="reference internal" href="#mozanalysis.experiment.Experiment.get_single_window_data" title="mozanalysis.experiment.Experiment.get_single_window_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_single_window_data()</span></code></a>, according to your use case,
which will run the query for you and return a materialized
dataframe.</p>
<p>The optional <code class="docutils literal notranslate"><span class="pre">exposure_signal</span></code> parameter allows to check if
clients have received the exposure signal during enrollment or
after. When using the exposures analysis basis, metrics will
be computed for these clients.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metric_list</strong> (<em>list</em><em> of </em><em>mozanalysis.metric.Metric</em><em> or </em><em>str</em>) – The metrics to analyze.</p></li>
<li><p><strong>time_limits</strong> (<a class="reference internal" href="#mozanalysis.experiment.TimeLimits" title="mozanalysis.experiment.TimeLimits"><em>TimeLimits</em></a>) – An object describing the
interval(s) to query</p></li>
<li><p><strong>enrollments_table</strong> (<em>str</em>) – The name of the enrollments table</p></li>
<li><p><strong>basis</strong> (<a class="reference internal" href="metrics.html#mozanalysis.metrics.AnalysisBasis" title="mozanalysis.metrics.AnalysisBasis"><em>AnalysisBasis</em></a>) – Use exposures as basis for calculating
metrics if True, otherwise use enrollments.</p></li>
<li><p><strong>exposure_signal</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="exposure.html#mozanalysis.exposure.ExposureSignal" title="mozanalysis.exposure.ExposureSignal"><em>ExposureSignal</em></a><em>]</em>) – Optional exposure
signal parameter that will be used for computing metrics
for certain analysis bases (such as exposures).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A string containing a BigQuery SQL expression.</p>
</dd>
</dl>
<p>Building this query is the main goal of this module.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mozanalysis.experiment.TimeLimits">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mozanalysis.experiment.</span></span><span class="sig-name descname"><span class="pre">TimeLimits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">first_enrollment_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_enrollment_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_date_data_required</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_date_data_required</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_windows</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#TimeLimits"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.TimeLimits" title="Link to this definition"></a></dt>
<dd><p>Expresses time limits for different kinds of analysis windows.</p>
<p>Instantiated and used by the <a class="reference internal" href="#mozanalysis.experiment.Experiment" title="mozanalysis.experiment.Experiment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code></a> class; end users
should not need to interact with it.</p>
<p>Do not directly instantiate: use the constructors provided.</p>
<p>There are several time constraints needed to specify a valid query
for experiment data:</p>
<blockquote>
<div><ul class="simple">
<li><p>When did enrollments start?</p></li>
<li><p>When did enrollments stop?</p></li>
<li><p>How long after enrollment does the analysis window start?</p></li>
<li><p>How long is the analysis window?</p></li>
</ul>
</div></blockquote>
<p>Even if these four quantities are specified directly, it is
important to check that they are consistent with the available
data - i.e. that we have data for the entire analysis window for
every enrollment.</p>
<p>Furthermore, there are some extra quantities that are useful for
writing efficient queries:</p>
<blockquote>
<div><ul class="simple">
<li><p>What is the first date for which we need data from our data
source?</p></li>
<li><p>What is the last date for which we need data from our data
source?</p></li>
</ul>
</div></blockquote>
<p>Instances of this class store all these quantities and do validation
to make sure that they’re consistent. The “store lots of overlapping
state and validate” strategy was chosen over “store minimal state
and compute on the fly” because different state is supplied in
different contexts.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.TimeLimits.for_single_analysis_window">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">for_single_analysis_window</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">first_enrollment_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_date_full_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_start_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_length_dates</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_dates_enrollment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#mozanalysis.experiment.TimeLimits" title="mozanalysis.experiment.TimeLimits"><span class="pre">TimeLimits</span></a></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#TimeLimits.for_single_analysis_window"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.TimeLimits.for_single_analysis_window" title="Link to this definition"></a></dt>
<dd><p>Return a <code class="docutils literal notranslate"><span class="pre">TimeLimits</span></code> instance with the following parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>first_enrollment_date</strong> (<em>str</em>) – First date on which enrollment
events were received; the start date of the experiment.</p></li>
<li><p><strong>last_date_full_data</strong> (<em>str</em>) – The most recent date for which we
have complete data, e.g. ‘2019-03-22’. If you want to ignore
all data collected after a certain date (e.g. when the
experiment recipe was deactivated), then do that here.</p></li>
<li><p><strong>analysis_start_days</strong> (<em>int</em>) – the start of the analysis window,
measured in ‘days since the client enrolled’. We ignore data
collected outside this analysis window.</p></li>
<li><p><strong>analysis_length_days</strong> (<em>int</em>) – the length of the analysis window,
measured in days.</p></li>
<li><p><strong>num_dates_enrollment</strong> (<em>int</em><em>, </em><em>optional</em>) – Only include this many days
of enrollments. If <code class="docutils literal notranslate"><span class="pre">None</span></code> then use the maximum number of days
as determined by the metric’s analysis window and
<code class="docutils literal notranslate"><span class="pre">last_date_full_data</span></code>. Typically <code class="docutils literal notranslate"><span class="pre">7n+1</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">8</span></code>. The
factor <code class="docutils literal notranslate"><span class="pre">7</span></code> removes weekly seasonality, and the <code class="docutils literal notranslate"><span class="pre">+1</span></code>
accounts for the fact that enrollment typically starts a few
hours before UTC midnight.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.TimeLimits.for_ts">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">for_ts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">first_enrollment_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_date_full_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_series_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_dates_enrollment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#mozanalysis.experiment.TimeLimits" title="mozanalysis.experiment.TimeLimits"><span class="pre">TimeLimits</span></a></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#TimeLimits.for_ts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.TimeLimits.for_ts" title="Link to this definition"></a></dt>
<dd><p>Return a <code class="docutils literal notranslate"><span class="pre">TimeLimits</span></code> instance for a time series.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>first_enrollment_date</strong> (<em>str</em>) – First date on which enrollment
events were received; the start date of the experiment.</p></li>
<li><p><strong>last_date_full_data</strong> (<em>str</em>) – The most recent date for which we
have complete data, e.g. ‘2019-03-22’. If you want to ignore
all data collected after a certain date (e.g. when the
experiment recipe was deactivated), then do that here.</p></li>
<li><p><strong>time_series_period</strong> – ‘daily’ or ‘weekly’.</p></li>
<li><p><strong>num_dates_enrollment</strong> (<em>int</em>) – Take this many days of client
enrollments. This is a mandatory argument because it
determines the number of points in the time series.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mozanalysis.experiment.AnalysisWindow">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mozanalysis.experiment.</span></span><span class="sig-name descname"><span class="pre">AnalysisWindow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#AnalysisWindow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.AnalysisWindow" title="Link to this definition"></a></dt>
<dd><p>Represents the range of days in which to measure a metric.</p>
<p>The range is measured in “days relative enrollment”, and is inclusive.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">AnalysisWindow(0,</span> <span class="pre">6)</span></code> is the first week after enrollment
and <cite>AnalysisWindow(-8,-1)</cite> is the week before enrollment</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start</strong> (<em>int</em>) – First day of the analysis window, in days relative
to enrollment start. 0 indicates the date of enrollment.
Positive numbers are after enrollment, negative are before.
Must be the same sign as <cite>end</cite> (zero counts as positive)</p></li>
<li><p><strong>end</strong> (<em>int</em>) – Final day of the analysis window, in days relative
to enrollment start. 0 indicates the date of enrollment.
Positive numbers are after enrollment, negative are before.
Must be the same sign as <cite>start</cite> (zero counts as positive).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mozanalysis.experiment.TimeSeriesResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mozanalysis.experiment.</span></span><span class="sig-name descname"><span class="pre">TimeSeriesResult</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fully_qualified_table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_windows</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#TimeSeriesResult"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.TimeSeriesResult" title="Link to this definition"></a></dt>
<dd><p>Result from a time series query.</p>
<p>For each analysis window, this object lets us get a dataframe in
“the standard format” (one row per client).</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">time_series_result</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">bq_context</span><span class="p">))</span>
<span class="n">window_0</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">window_0</span></code> would then be a pandas DataFrame of results for the
analysis window starting at day 0. <code class="docutils literal notranslate"><span class="pre">result_dict</span></code> would be a
dictionary of all such DataFrames, keyed by the start days of
their analysis windows.</p>
<p>Or, to load only one analysis window into RAM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">window_0</span> <span class="o">=</span> <span class="n">time_series_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bq_context</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.TimeSeriesResult.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bq_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><span class="pre">BigQueryContext</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_window</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#TimeSeriesResult.get"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.TimeSeriesResult.get" title="Link to this definition"></a></dt>
<dd><p>Get the DataFrame for a specific analysis window.</p>
<p>N.B. this makes a BigQuery query each time it is run; caching
results is your responsibility.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bq_context</strong> (<a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><em>BigQueryContext</em></a>)</p></li>
<li><p><strong>analysis_window</strong> (<a class="reference internal" href="#mozanalysis.experiment.AnalysisWindow" title="mozanalysis.experiment.AnalysisWindow"><em>AnalysisWindow</em></a><em> or </em><em>int</em>) – The analysis
window, or its start day as an int.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.TimeSeriesResult.get_full_data">
<span class="sig-name descname"><span class="pre">get_full_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bq_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><span class="pre">BigQueryContext</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#TimeSeriesResult.get_full_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.TimeSeriesResult.get_full_data" title="Link to this definition"></a></dt>
<dd><p>Get the full DataFrame from TimeSeriesResult.</p>
<p>This DataFrame has a row for each client for each period of the time
series and may be very large. A warning will print the size of data
to be downloaded.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>bq_context</strong> (<a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><em>BigQueryContext</em></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.experiment.TimeSeriesResult.get_aggregated_data">
<span class="sig-name descname"><span class="pre">get_aggregated_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bq_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><span class="pre">BigQueryContext</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate_function</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'AVG'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/mozanalysis/experiment.html#TimeSeriesResult.get_aggregated_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.experiment.TimeSeriesResult.get_aggregated_data" title="Link to this definition"></a></dt>
<dd><p>Results from a time series query, aggregated over analysis windows
by a SQL aggregate function.</p>
<p>This DataFrame has a row for each analysis window, with a column
for each metric in the supplied metric_list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bq_context</strong> (<a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><em>BigQueryContext</em></a>)</p></li>
<li><p><strong>metric_list</strong> (<em>list</em><em> of </em><a class="reference internal" href="metrics.html#mozanalysis.metrics.Metric" title="mozanalysis.metrics.Metric"><em>mozanalysis.metrics.Metric</em></a>)</p></li>
<li><p><strong>aggregate_fuction</strong> (<em>str</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="config.html" class="btn btn-neutral float-left" title="mozanalysis.config" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="exposure.html" class="btn btn-neutral float-right" title="mozanalysis.exposure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Mozilla.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>