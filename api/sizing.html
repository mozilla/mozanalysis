<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mozanalysis.sizing &mdash; mozanalysis  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="mozanalysis.segments.desktop" href="segments/desktop.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            mozanalysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Mozanalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide.html">Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">API Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bayesian_stats.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bayesian_stats</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="bayesian_stats/bayesian_bootstrap.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bayesian_stats.bayesian_bootstrap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="bayesian_stats/binary.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bayesian_stats.binary</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="bayesian_stats/survival_func.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bayesian_stats.survival_func</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="bq.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.bq</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.config</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="experiment.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.experiment</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="exposure.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.exposure</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="frequentist_stats/bootstrap.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.frequentist_stats.bootstrap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="frequentist_stats/sample_size.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.frequentist_stats.sample_size</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.metrics</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics/desktop.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.metrics.desktop</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics/fenix.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.metrics.fenix</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics/firefox_ios.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.metrics.firefox_ios</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="segments.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.segments</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="segments/desktop.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.segments.desktop</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.sizing</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget"><code class="docutils literal notranslate"><span class="pre">HistoricalTarget</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.experiment_name"><code class="docutils literal notranslate"><span class="pre">HistoricalTarget.experiment_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.start_date"><code class="docutils literal notranslate"><span class="pre">HistoricalTarget.start_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.num_dates_enrollment"><code class="docutils literal notranslate"><span class="pre">HistoricalTarget.num_dates_enrollment</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.analysis_length"><code class="docutils literal notranslate"><span class="pre">HistoricalTarget.analysis_length</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.get_single_window_data"><code class="docutils literal notranslate"><span class="pre">HistoricalTarget.get_single_window_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.get_time_series_data"><code class="docutils literal notranslate"><span class="pre">HistoricalTarget.get_time_series_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.build_metrics_query"><code class="docutils literal notranslate"><span class="pre">HistoricalTarget.build_metrics_query()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mozanalysis.sizing.ContinuousEnrollmentTimeLimits"><code class="docutils literal notranslate"><span class="pre">ContinuousEnrollmentTimeLimits</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mozanalysis.sizing.ContinuousEnrollmentTimeLimits.for_single_analysis_window"><code class="docutils literal notranslate"><span class="pre">ContinuousEnrollmentTimeLimits.for_single_analysis_window()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">mozanalysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api.html">API Documentation</a></li>
      <li class="breadcrumb-item active"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.sizing</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/sizing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-mozanalysis.sizing">
<span id="mozanalysis-sizing"></span><h1><a class="reference internal" href="#module-mozanalysis.sizing" title="mozanalysis.sizing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozanalysis.sizing</span></code></a><a class="headerlink" href="#module-mozanalysis.sizing" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mozanalysis.sizing.HistoricalTarget">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mozanalysis.sizing.</span></span><span class="sig-name descname"><span class="pre">HistoricalTarget</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_dates_enrollment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuous_enrollment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">app_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrics_sql</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets_sql</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mozanalysis/sizing.html#HistoricalTarget"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.sizing.HistoricalTarget" title="Permalink to this definition"></a></dt>
<dd><p>Query historical data.</p>
<p>The methods here query data in a way compatible with the following
principles, which are important for experiment analysis:</p>
<p>Example usage (in a colab notebook):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="n">auth</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Authenticated&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">mozanalysis.metrics.desktop</span> <span class="kn">import</span> <span class="n">active_hours</span><span class="p">,</span> <span class="n">uri_count</span>
<span class="kn">from</span> <span class="nn">mozanalysis.segments.desktop</span> <span class="kn">import</span> <span class="n">allweek_regular_v1</span><span class="p">,</span>             <span class="n">new_or_resurrected_v3</span>

<span class="n">bq_context</span> <span class="o">=</span> <span class="n">BigQueryContext</span><span class="p">(</span>
    <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;mbowerman&#39;</span><span class="p">,</span>  <span class="c1"># e.g. mine&#39;s mbowerman</span>
    <span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;moz-fx-data-bq-data-science&#39;</span>  <span class="c1"># this is the default anyway</span>
<span class="p">)</span>

<span class="n">ht</span> <span class="o">=</span> <span class="n">HistoricalTarget</span><span class="p">(</span>
    <span class="n">experiment_name</span><span class="o">=</span><span class="s1">&#39;my_test_name&#39;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">,</span>
    <span class="n">num_dates_enrollment</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">analysis_length</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>

<span class="c1"># Run the query and get the results as a DataFrame</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">ht</span><span class="o">.</span><span class="n">get_single_window_data</span><span class="p">(</span>
    <span class="n">bq_context</span><span class="p">,</span>
    <span class="n">metric_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">active_hours</span><span class="p">,</span>
        <span class="n">uri_count</span>
    <span class="p">],</span>
    <span class="n">target_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">allweek_regular_v1</span><span class="p">,</span>
        <span class="n">new_or_resurrected_v3</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">targets_sql</span> <span class="o">=</span> <span class="n">ht</span><span class="o">.</span><span class="n">get_targets_sql</span><span class="p">()</span>

<span class="n">metrics_sql</span> <span class="o">=</span> <span class="n">ht</span><span class="o">.</span><span class="n">get_metrics_sql</span><span class="p">()</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> (<em>str</em>) – A simple name of this analysis, which is used
to create table names when saving results in BigQuery.</p></li>
<li><p><strong>start_date</strong> (<em>str</em>) – e.g. ‘2019-01-01’. First date for historical data to be
retrieved.</p></li>
<li><p><strong>analysis_length</strong> (<em>int</em>) – Number of days to include for analysis</p></li>
<li><p><strong>num_dates_enrollment</strong> (<em>int</em><em>, </em><em>default 7</em>) – Number of days to consider to
enroll clients in the analysis.</p></li>
<li><p><strong>continuous_enrollment</strong> (<em>bool</em>) – Indicates if the analysis dates
and enrollment should be overlap; clients that satisfy the
target conditions at any point in the analysis will be
included for the entire window when calculating metrics.</p></li>
<li><p><strong>app_id</strong> (<em>str</em><em>, </em><em>optional</em>) – For a Glean app, the name of the BigQuery
dataset derived from its app ID, like <cite>org_mozilla_firefox</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="mozanalysis.sizing.HistoricalTarget.experiment_name">
<span class="sig-name descname"><span class="pre">experiment_name</span></span><a class="headerlink" href="#mozanalysis.sizing.HistoricalTarget.experiment_name" title="Permalink to this definition"></a></dt>
<dd><p>Name of the study, used in naming tables
related to this analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mozanalysis.sizing.HistoricalTarget.start_date">
<span class="sig-name descname"><span class="pre">start_date</span></span><a class="headerlink" href="#mozanalysis.sizing.HistoricalTarget.start_date" title="Permalink to this definition"></a></dt>
<dd><p>e.g. ‘2019-01-01’. First date on which enrollment
events were received.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mozanalysis.sizing.HistoricalTarget.num_dates_enrollment">
<span class="sig-name descname"><span class="pre">num_dates_enrollment</span></span><a class="headerlink" href="#mozanalysis.sizing.HistoricalTarget.num_dates_enrollment" title="Permalink to this definition"></a></dt>
<dd><p>Number of days to consider to enroll clients
in the analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mozanalysis.sizing.HistoricalTarget.analysis_length">
<span class="sig-name descname"><span class="pre">analysis_length</span></span><a class="headerlink" href="#mozanalysis.sizing.HistoricalTarget.analysis_length" title="Permalink to this definition"></a></dt>
<dd><p>Number of days to include for analysis</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.sizing.HistoricalTarget.get_single_window_data">
<span class="sig-name descname"><span class="pre">get_single_window_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bq_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><span class="pre">BigQueryContext</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="metrics.html#mozanalysis.metrics.Metric" title="mozanalysis.metrics.Metric"><span class="pre">Metric</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="segments.html#mozanalysis.segments.Segment" title="mozanalysis.segments.Segment"><span class="pre">Segment</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_targets_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace_tables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/mozanalysis/sizing.html#HistoricalTarget.get_single_window_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.sizing.HistoricalTarget.get_single_window_data" title="Permalink to this definition"></a></dt>
<dd><p>Return a DataFrame containing per-client metric values.</p>
<p>Also store them in a permanent table in BigQuery. The name of
this table will be printed. Subsequent calls to this function
will simply read the results from this table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bq_context</strong> (<a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><em>BigQueryContext</em></a>) – BigQuery configuration and client.</p></li>
<li><p><strong>metric_list</strong> (<em>list</em><em> of </em><em>mozanalysis.metric.Metric</em>) – The metrics
to analyze.</p></li>
<li><p><strong>target_list</strong> (<em>list</em><em> of </em><a class="reference internal" href="segments.html#mozanalysis.segments.Segment" title="mozanalysis.segments.Segment"><em>mozanalysis.segments.Segment</em></a>) – The targets
that define clients to be included in the analysis, based on
inclusion in a defined user segment. For each Segment included
in the list, client IDs are identified in the
SegmentDataSource that based on the select_for statement in
the Segment. Client IDs that satisfy the select_for
statement in every Segment in the target_list will be
returned by the query.</p></li>
<li><p><strong>custom_targets_query</strong> (<em>str</em>) – <p>A full SQL query to be used
in the main query; must include a client_id column
to join to metrics tables and an enrollment_date:</p>
<p>N.B. this query’s results must be uniquely keyed by
(client_id, enrollment_date), or else your results will be
subtly wrong.</p>
</p></li>
<li><p><strong>replace_tables</strong> (<em>bool</em>) – If True, delete tables that exist in
BigQuery with the same name; used to rerun analyses under
the same experiment name with different settings</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A pandas DataFrame of experiment data. One row per <code class="docutils literal notranslate"><span class="pre">client_id</span></code>.
Some metadata columns, then one column per metric in
<code class="docutils literal notranslate"><span class="pre">metric_list</span></code>, and one column per sanity-check metric.
Columns (not necessarily in order):</p>
<blockquote>
<div><ul class="simple">
<li><p>client_id (str): Not necessary for “happy path” analyses.</p></li>
<li><p>Analysis window (int): Start and end of analysis window, in
days of entire analysis included in the window</p></li>
<li><p>[metric 1]: The client’s value for the first metric in
<code class="docutils literal notranslate"><span class="pre">metric_list</span></code>.</p></li>
<li><p>…</p></li>
<li><p>[metric n]: The client’s value for the nth (final)
metric in <code class="docutils literal notranslate"><span class="pre">metric_list</span></code>.</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.sizing.HistoricalTarget.get_time_series_data">
<span class="sig-name descname"><span class="pre">get_time_series_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bq_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><span class="pre">BigQueryContext</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="metrics.html#mozanalysis.metrics.Metric" title="mozanalysis.metrics.Metric"><span class="pre">Metric</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_series_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'weekly'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_targets_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget" title="mozanalysis.sizing.HistoricalTarget"><span class="pre">HistoricalTarget</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace_tables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="experiment.html#mozanalysis.experiment.TimeSeriesResult" title="mozanalysis.experiment.TimeSeriesResult"><span class="pre">TimeSeriesResult</span></a></span></span><a class="reference internal" href="../_modules/mozanalysis/sizing.html#HistoricalTarget.get_time_series_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.sizing.HistoricalTarget.get_time_series_data" title="Permalink to this definition"></a></dt>
<dd><p>Return a TimeSeriesResult with per-client metric values.</p>
<p>Roughly equivalent to looping over <a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.get_single_window_data" title="mozanalysis.sizing.HistoricalTarget.get_single_window_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_single_window_data()</span></code></a>
with different analysis windows, and reorganising the results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bq_context</strong> (<a class="reference internal" href="bq.html#mozanalysis.bq.BigQueryContext" title="mozanalysis.bq.BigQueryContext"><em>BigQueryContext</em></a>) – BigQuery configuration and client.</p></li>
<li><p><strong>metric_list</strong> (<em>list</em><em> of </em><em>mozanalysis.metric.Metric</em>) – The metrics
to analyze.</p></li>
<li><p><strong>time_series_period</strong> (<em>str</em>) – Period of the time series for which to
retrieve data. Options are daily, weekly, and 28_day.</p></li>
<li><p><strong>target_list</strong> (<em>list</em><em> of </em><a class="reference internal" href="segments.html#mozanalysis.segments.Segment" title="mozanalysis.segments.Segment"><em>mozanalysis.segments.Segment</em></a>) – The targets
that define clients to be included in the analysis, based on
inclusion in a defined user segment. For each Segment included
in the list, client IDs are identified in the
SegmentDataSource that based on the select_for statement in
the Segment. Client IDs that satisfy the select_for
statement in every Segment in the target_list will be
returned by the query.</p></li>
<li><p><strong>custom_targets_query</strong> (<em>str</em>) – <p>A full SQL query to be used
in the main query; must include a client_id column
to join to metrics tables and an enrollment_date:</p>
<p>N.B. this query’s results must be uniquely keyed by
(client_id, enrollment_date), or else your results will be
subtly wrong.</p>
</p></li>
<li><p><strong>replace_tables</strong> (<em>bool</em>) – If True, delete tables that exist in
BigQuery with the same name; used to rerun analyses under
the same experiment name with different settings</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A <a class="reference internal" href="experiment.html#mozanalysis.experiment.TimeSeriesResult" title="mozanalysis.experiment.TimeSeriesResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">mozanalysis.experiment.TimeSeriesResult</span></code></a> object,
which may be used to obtain a
pandas DataFrame of per-client metric data, for each
analysis window. Each DataFrame is a pandas DataFrame in
“the standard format”: one row per client, some metadata
columns, plus one column per metric and sanity-check metric.
Its columns (not necessarily in order):</p>
<blockquote>
<div><ul class="simple">
<li><p>enrollment date and client_id</p></li>
<li><p>[metric 1]: The client’s value for the first metric in
<code class="docutils literal notranslate"><span class="pre">metric_list</span></code>.</p></li>
<li><p>…</p></li>
<li><p>[metric n]: The client’s value for the nth (final)
metric in <code class="docutils literal notranslate"><span class="pre">metric_list</span></code>.</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.sizing.HistoricalTarget.build_metrics_query">
<span class="sig-name descname"><span class="pre">build_metrics_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metric_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="metrics.html#mozanalysis.metrics.Metric" title="mozanalysis.metrics.Metric"><span class="pre">Metric</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_limits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="experiment.html#mozanalysis.experiment.TimeLimits" title="mozanalysis.experiment.TimeLimits"><span class="pre">TimeLimits</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mozanalysis/sizing.html#HistoricalTarget.build_metrics_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.sizing.HistoricalTarget.build_metrics_query" title="Permalink to this definition"></a></dt>
<dd><p>Return a SQL query for querying metric data.</p>
<p>For interactive use, prefer <a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.get_single_window_data" title="mozanalysis.sizing.HistoricalTarget.get_single_window_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_single_window_data()</span></code></a>
or TODO <a class="reference internal" href="#mozanalysis.sizing.HistoricalTarget.get_time_series_data" title="mozanalysis.sizing.HistoricalTarget.get_time_series_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_time_series_data()</span></code></a>, according to your use case,
which will run the query for you and return a materialized
dataframe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metric_list</strong> (<em>list</em><em> of </em><em>mozanalysis.metric.Metric</em>) – The metrics to analyze.</p></li>
<li><p><strong>time_limits</strong> (<a class="reference internal" href="experiment.html#mozanalysis.experiment.TimeLimits" title="mozanalysis.experiment.TimeLimits"><em>TimeLimits</em></a>) – An object describing the
interval(s) to query</p></li>
<li><p><strong>targets_table</strong> (<em>str</em>) – The name of the targets BigQuery table</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A string containing a BigQuery SQL expression.</p>
</dd>
</dl>
<p>Building this query is the main goal of this module.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mozanalysis.sizing.ContinuousEnrollmentTimeLimits">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mozanalysis.sizing.</span></span><span class="sig-name descname"><span class="pre">ContinuousEnrollmentTimeLimits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">first_enrollment_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_enrollment_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_date_data_required</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_date_data_required</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_windows</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="experiment.html#mozanalysis.experiment.AnalysisWindow" title="mozanalysis.experiment.AnalysisWindow"><span class="pre">AnalysisWindow</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mozanalysis/sizing.html#ContinuousEnrollmentTimeLimits"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.sizing.ContinuousEnrollmentTimeLimits" title="Permalink to this definition"></a></dt>
<dd><p>Expresses time limits for different kinds of analysis windows.</p>
<p>Instantiated and used by the <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code> class; end users
should not need to interact with it.</p>
<p>Do not directly instantiate: use the constructors provided.</p>
<p>There are several time constraints needed to specify a valid query
for experiment data:</p>
<blockquote>
<div><ul class="simple">
<li><p>When did enrollments start?</p></li>
<li><p>When did enrollments stop?</p></li>
<li><p>How long after enrollment does the analysis window start?</p></li>
<li><p>How long is the analysis window?</p></li>
</ul>
</div></blockquote>
<p>Even if these four quantities are specified directly, it is
important to check that they are consistent with the available
data - i.e. that we have data for the entire analysis window for
every enrollment.</p>
<p>Furthermore, there are some extra quantities that are useful for
writing efficient queries:</p>
<blockquote>
<div><ul class="simple">
<li><p>What is the first date for which we need data from our data
source?</p></li>
<li><p>What is the last date for which we need data from our data
source?</p></li>
</ul>
</div></blockquote>
<p>Instances of this class store all these quantities and do validation
to make sure that they’re consistent. The “store lots of overlapping
state and validate” strategy was chosen over “store minimal state
and compute on the fly” because different state is supplied in
different contexts.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mozanalysis.sizing.ContinuousEnrollmentTimeLimits.for_single_analysis_window">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">for_single_analysis_window</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">first_date_full_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analysis_length_dates</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#mozanalysis.sizing.ContinuousEnrollmentTimeLimits" title="mozanalysis.sizing.ContinuousEnrollmentTimeLimits"><span class="pre">ContinuousEnrollmentTimeLimits</span></a></span></span><a class="reference internal" href="../_modules/mozanalysis/sizing.html#ContinuousEnrollmentTimeLimits.for_single_analysis_window"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mozanalysis.sizing.ContinuousEnrollmentTimeLimits.for_single_analysis_window" title="Permalink to this definition"></a></dt>
<dd><p>Return a <code class="docutils literal notranslate"><span class="pre">ContinuousEnrollmentTimeLimits</span></code> instance with the following
parameters:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>first_enrollment_date</strong> (<em>str</em>) – First date on which enrollment
events were received; the start date of the experiment.</p></li>
<li><p><strong>last_date_full_data</strong> (<em>str</em>) – The most recent date for which we
have complete data, e.g. ‘2019-03-22’. If you want to ignore
all data collected after a certain date (e.g. when the
experiment recipe was deactivated), then do that here.</p></li>
<li><p><strong>analysis_start_days</strong> (<em>int</em>) – the start of the analysis window,
measured in ‘days since the client enrolled’. We ignore data
collected outside this analysis window.</p></li>
<li><p><strong>analysis_length_days</strong> (<em>int</em>) – the length of the analysis window,
measured in days.</p></li>
<li><p><strong>num_dates_enrollment</strong> (<em>int</em><em>, </em><em>optional</em>) – Only include this many days
of enrollments. If <code class="docutils literal notranslate"><span class="pre">None</span></code> then use the maximum number of days
as determined by the metric’s analysis window and
<code class="docutils literal notranslate"><span class="pre">last_date_full_data</span></code>. Typically <code class="docutils literal notranslate"><span class="pre">7n+1</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">8</span></code>. The
factor <code class="docutils literal notranslate"><span class="pre">7</span></code> removes weekly seasonality, and the <code class="docutils literal notranslate"><span class="pre">+1</span></code>
accounts for the fact that enrollment typically starts a few
hours before UTC midnight.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="segments/desktop.html" class="btn btn-neutral float-left" title="mozanalysis.segments.desktop" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Mozilla.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>